{
  "hash": "0badc5ef25d5a08795a4c568edffc11c",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Assignment 2: Spatial Analysis and Visualization\"\nsubtitle: \"Healthcare Access and Equity in Pennsylvania\"\nauthor: \"Fan Yang\"\ndate: \"September 29, 2025\"\nformat: \n  html:\n    code-fold: false\n    toc: true\n    toc-location: left\n    theme: cosmo\n    embed-resources: true\nexecute:\n  warning: false\n  message: false\n---\n\n## Assignment Overview\n\n**Learning Objectives:**\n- Apply spatial operations to answer policy-relevant research questions\n- Integrate census demographic data with spatial analysis\n- Create publication-quality visualizations and maps\n- Work with spatial data from multiple sources\n- Communicate findings effectively for policy audiences\n\n---\n\n## Part 1: Healthcare Access for Vulnerable Populations\n\n### Research Question\n\n**Which Pennsylvania counties have the highest proportion of vulnerable populations (elderly + low-income) living far from hospitals?**\n\nYour analysis should identify counties that should be priorities for healthcare investment and policy intervention.\n\n### Required Analysis Steps\n\nComplete the following analysis, documenting each step with code and brief explanations:\n\n#### Step 1: Data Collection (5 points)\n\nLoad the required spatial data:\n- Pennsylvania county boundaries\n- Pennsylvania hospitals (from lecture data)\n- Pennsylvania census tracts\n\n**Your Task:**\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load required packages\n# Load required packages\nlibrary(sf)\nlibrary(tidyverse)\nlibrary(tidycensus)\nlibrary(tigris)\nlibrary(ggplot2)\nlibrary(knitr)\nlibrary(kableExtra)\nlibrary(units)\nlibrary(patchwork)\nlibrary(ggspatial)\n\ncensus_api_key(\"86993dedbe98d77b9d79db6b8ba21a7fde55cb91\", install = TRUE, overwrite = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"86993dedbe98d77b9d79db6b8ba21a7fde55cb91\"\n```\n\n\n:::\n\n```{.r .cell-code}\n# Load spatial data ---------------------------------------------------------\n# Pennsylvania county boundaries\nlibrary(here)\n\npa_counties <- st_read(here(\"assignments\", \"assignment_2\", \"data\", \"Pennsylvania_County_Boundaries.shp\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `Pennsylvania_County_Boundaries' from data source \n  `D:\\UPENN\\MUSA5080\\portfolio-setup-FANYANG0304\\assignments\\assignment_2\\data\\Pennsylvania_County_Boundaries.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 67 features and 19 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -8963377 ymin: 4825316 xmax: -8314404 ymax: 5201413\nProjected CRS: WGS 84 / Pseudo-Mercator\n```\n\n\n:::\n\n```{.r .cell-code}\nhospitals   <- st_read(here(\"assignments\", \"assignment_2\", \"data\", \"hospitals.geojson\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `hospitals' from data source \n  `D:\\UPENN\\MUSA5080\\portfolio-setup-FANYANG0304\\assignments\\assignment_2\\data\\hospitals.geojson' \n  using driver `GeoJSON'\nSimple feature collection with 223 features and 11 fields\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: -80.49621 ymin: 39.75163 xmax: -74.86704 ymax: 42.13403\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n\n```{.r .cell-code}\n# Pennsylvania census tracts\npa_tracts <- tracts(\"PA\", year = 2022, cb = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |=                                                                     |   1%\n  |                                                                            \n  |==                                                                    |   2%\n  |                                                                            \n  |==                                                                    |   3%\n  |                                                                            \n  |==                                                                    |   4%\n  |                                                                            \n  |===                                                                   |   5%\n  |                                                                            \n  |====                                                                  |   5%\n  |                                                                            \n  |====                                                                  |   6%\n  |                                                                            \n  |=====                                                                 |   7%\n  |                                                                            \n  |======                                                                |   8%\n  |                                                                            \n  |=======                                                               |  10%\n  |                                                                            \n  |========                                                              |  11%\n  |                                                                            \n  |=========                                                             |  13%\n  |                                                                            \n  |===========                                                           |  15%\n  |                                                                            \n  |=============                                                         |  19%\n  |                                                                            \n  |==============                                                        |  20%\n  |                                                                            \n  |=================                                                     |  24%\n  |                                                                            \n  |=====================                                                 |  29%\n  |                                                                            \n  |=====================                                                 |  30%\n  |                                                                            \n  |=========================                                             |  35%\n  |                                                                            \n  |===========================                                           |  38%\n  |                                                                            \n  |=================================                                     |  47%\n  |                                                                            \n  |=======================================                               |  56%\n  |                                                                            \n  |==============================================                        |  65%\n  |                                                                            \n  |==================================================                    |  72%\n  |                                                                            \n  |========================================================              |  80%\n  |                                                                            \n  |==============================================================        |  88%\n  |                                                                            \n  |===================================================================== |  98%\n  |                                                                            \n  |======================================================================| 100%\n```\n\n\n:::\n\n```{.r .cell-code}\n# 1. How many hospitals?\ncat(\"1. Number of hospitals in dataset:\", nrow(hospitals), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n1. Number of hospitals in dataset: 223 \n```\n\n\n:::\n\n```{.r .cell-code}\n# 2. How many census tracts?\ncat(\"2. Number of census tracts in dataset:\", nrow(pa_tracts), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n2. Number of census tracts in dataset: 3445 \n```\n\n\n:::\n\n```{.r .cell-code}\n# 3. CRS information\ncat(\"Counties CRS:\", st_crs(pa_counties)$input, \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCounties CRS: WGS 84 / Pseudo-Mercator \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Hospitals CRS:\", st_crs(hospitals)$input, \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nHospitals CRS: WGS 84 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Census tracts CRS:\", st_crs(pa_tracts)$input, \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCensus tracts CRS: NAD83 \n```\n\n\n:::\n:::\n\n\n**Questions to answer:**\n\n- How many hospitals are in your dataset? **223**\n\n- How many census tracts? **3,445**\n\n- What coordinate reference system is each dataset in? \n  - Counties: WGS 84 / Pseudo-Mercator\n  - Hospitals: WGS 84\n  - Census tracts: NAD83\n\n---\n\n#### Step 2: Get Demographic Data \n\nUse `tidycensus` to download tract-level demographic data for Pennsylvania.\n\n**Required variables:**\n\n- Total population\n- Median household income\n- Population 65 years and over (you may need to sum multiple age categories)\n\n**Your Task:**\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get demographic data from ACS\n# Set census API key (you'll need to get your own key from census.gov)\n# census_api_key(\"YOUR_API_KEY_HERE\", install = TRUE)\n\n# Get demographic data for Pennsylvania tracts\npa_demographics <- get_acs(\n  geography = \"tract\",\n  state = \"PA\",\n  variables = c(\n    total_pop = \"B01003_001\",           # Total population\n    median_income = \"B19013_001\",       # Median household income\n    pop_65_74 = \"B01001_020\",          # Population 65-74 years\n    pop_75_84 = \"B01001_021\",          # Population 75-84 years  \n    pop_85_plus = \"B01001_022\"         # Population 85 years and over\n  ),\n  year = 2022,\n  geometry = TRUE\n)\n\n# Pivot the data to wide format\npa_demographics_wide <- pa_demographics %>%\n  select(GEOID, NAME, variable, estimate) %>%\n  pivot_wider(names_from = variable, values_from = estimate) %>%\n  # Calculate total elderly population (65+)\n  mutate(\n    pop_65_plus = pop_65_74 + pop_75_84 + pop_85_plus,\n    elderly_pct = (pop_65_plus / total_pop) * 100\n  )\n\n# Join to tract boundaries (already have geometry from get_acs)\ntracts_with_demographics <- pa_demographics_wide\n\n# Check for missing data\ncat(\"Missing income data:\", sum(is.na(tracts_with_demographics$median_income)), \"tracts\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nMissing income data: 63 tracts\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Median income across all PA tracts: $\", \n    median(tracts_with_demographics$median_income, na.rm = TRUE), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nMedian income across all PA tracts: $ 70188 \n```\n\n\n:::\n:::\n\n\n**Questions to answer:**\n\n- What year of ACS data are you using? **2022**\n\n- How many tracts have missing income data? **63 tracts**\n\n- What is the median income across all PA census tracts? **$70,188**\n\n#### Step 3: Define Vulnerable Populations \n\nIdentify census tracts with vulnerable populations based on TWO criteria:\n1. Low median household income (choose an appropriate threshold)\n2. Significant elderly population (choose an appropriate threshold)\n\n**Your Task:**\n\n::: {.cell}\n\n```{.r .cell-code}\n# Filter for vulnerable tracts based on your criteria\n# Define thresholds for vulnerability\nincome_threshold <- 60000  # Median household income below $60,000 (85% of PA median)\nelderly_threshold <- 15    # Elderly population above 15% (typical baseline threshold)\n\n# Create vulnerable population indicator\nvulnerable_tracts <- tracts_with_demographics %>%\n  filter(!is.na(median_income)) %>%  # Remove tracts with missing income data\n  mutate(\n    low_income = median_income < income_threshold,\n    high_elderly = elderly_pct > elderly_threshold,\n    vulnerable = low_income | high_elderly  # OR logic: either low income OR high elderly\n  )\n\n# Summary statistics\ncat(\"Income threshold: $\", income_threshold, \n    \" (PA median: $\", median(tracts_with_demographics$median_income, na.rm = TRUE), \")\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nIncome threshold: $ 60000  (PA median: $ 70188 )\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Elderly threshold: \", elderly_threshold, \"%\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nElderly threshold:  15 %\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Number of vulnerable tracts: \", sum(vulnerable_tracts$vulnerable), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nNumber of vulnerable tracts:  1116 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Percentage of PA tracts that are vulnerable: \", \n    round(sum(vulnerable_tracts$vulnerable) / nrow(vulnerable_tracts) * 100, 1), \"%\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nPercentage of PA tracts that are vulnerable:  33 %\n```\n\n\n:::\n\n```{.r .cell-code}\n# Show distribution of criteria\ncat(\"Low income tracts: \", sum(vulnerable_tracts$low_income), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLow income tracts:  1112 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"High elderly tracts: \", sum(vulnerable_tracts$high_elderly), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nHigh elderly tracts:  6 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Both criteria (vulnerable): \", sum(vulnerable_tracts$vulnerable), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nBoth criteria (vulnerable):  1116 \n```\n\n\n:::\n:::\n\n\n**Questions to answer:**\n\n- What income threshold did you choose and why?  \n  **$60,000** (85% of PA median), moderately low-income households\n\n- What elderly population threshold did you choose and why?  \n  **15%** (above typical baseline). Used OR logic (low income OR high elderly) instead of AND, as both criteria together were too restrictive.\n\n- How many tracts meet your vulnerability criteria? **1,116 tracts**\n\n- What percentage of PA census tracts are considered vulnerable by your definition? **33%**\n\n---\n\n#### Step 4: Calculate Distance to Hospitals \n\nFor each vulnerable tract, calculate the distance to the nearest hospital.\n\n**Your Task:**\n\n::: {.cell}\n\n```{.r .cell-code}\n# Transform to appropriate projected CRS\n# Use Pennsylvania State Plane South (EPSG:2272) for accurate distance calculations\npa_crs <- 2272  # Pennsylvania State Plane South\n\n# Transform all datasets to the same CRS\nvulnerable_tracts_proj <- st_transform(vulnerable_tracts, pa_crs)\nhospitals_proj <- st_transform(hospitals, pa_crs)\n\n# Calculate distance from each tract centroid to nearest hospital\n# Get centroids of vulnerable tracts\ntract_centroids <- st_centroid(vulnerable_tracts_proj)\n\n# Calculate distance matrix between tract centroids and hospitals\ndistances <- st_distance(tract_centroids, hospitals_proj)\n\n# Find minimum distance to nearest hospital for each tract\nmin_distances <- apply(distances, 1, min)\n\n# Convert from meters to miles (1 meter = 0.000621371 miles)\nmin_distances_miles <- as.numeric(min_distances) * 0.000621371\n\n# Add distance information to vulnerable tracts\nvulnerable_tracts_with_distance <- vulnerable_tracts_proj %>%\n  mutate(\n    distance_to_hospital_miles = min_distances_miles\n  )\n\n# Summary statistics\ncat(\"Average distance to nearest hospital for vulnerable tracts: \", \n    round(mean(min_distances_miles), 2), \" miles\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAverage distance to nearest hospital for vulnerable tracts:  14.54  miles\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Maximum distance to nearest hospital: \", \n    round(max(min_distances_miles), 2), \" miles\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nMaximum distance to nearest hospital:  107.76  miles\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Number of vulnerable tracts more than 15 miles from nearest hospital: \", \n    sum(min_distances_miles > 15), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nNumber of vulnerable tracts more than 15 miles from nearest hospital:  1094 \n```\n\n\n:::\n:::\n\n\n**Requirements:**\n\n- Use an appropriate projected coordinate system for Pennsylvania\n- Calculate distances in miles\n- Explain why you chose your projection\n\n**Questions to answer:**\n\n- What is the average distance to the nearest hospital for vulnerable tracts? **14.54 miles**\n\n- What is the maximum distance? **107.76 miles**\n\n- How many vulnerable tracts are more than 15 miles from the nearest hospital? **1,094 tracts**\n\n---\n\n#### Step 5: Identify Underserved Areas \n\nDefine \"underserved\" as vulnerable tracts that are more than 15 miles from the nearest hospital.\n\n**Your Task:**\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create underserved variable\n# Define \"underserved\" as vulnerable tracts more than 15 miles from nearest hospital\nunderserved_threshold <- 15  # miles\n\n# Add underserved indicator\nvulnerable_tracts_final <- vulnerable_tracts_with_distance %>%\n  mutate(\n    underserved = vulnerable & (distance_to_hospital_miles > underserved_threshold)\n  )\n\n# Summary statistics\ncat(\"Underserved threshold: \", underserved_threshold, \" miles from nearest hospital\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nUnderserved threshold:  15  miles from nearest hospital\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Number of underserved tracts: \", sum(vulnerable_tracts_final$underserved), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nNumber of underserved tracts:  251 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Percentage of vulnerable tracts that are underserved: \", \n    round(sum(vulnerable_tracts_final$underserved) / sum(vulnerable_tracts_final$vulnerable) * 100, 1), \"%\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nPercentage of vulnerable tracts that are underserved:  22.5 %\n```\n\n\n:::\n\n```{.r .cell-code}\n# Analysis of results\ntotal_vulnerable <- sum(vulnerable_tracts_final$vulnerable)\ntotal_underserved <- sum(vulnerable_tracts_final$underserved)\n\ncat(\"This result \", ifelse(total_underserved > total_vulnerable * 0.3, \"is concerning\", \"is somewhat expected\"), \n    \" because \", total_underserved, \" out of \", total_vulnerable, \n    \" vulnerable tracts (\", round(total_underserved/total_vulnerable*100, 1), \"%) are underserved.\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nThis result  is somewhat expected  because  251  out of  1116  vulnerable tracts ( 22.5 %) are underserved.\n```\n\n\n:::\n:::\n\n\n**Questions to answer:**\n\n- How many tracts are underserved? **251 tracts**\n\n- What percentage of vulnerable tracts are underserved? **22.5%**\n\n- Does this surprise you? Why or why not?  \n  Somewhat concerning. 22.5% of vulnerable tracts (251 tracts) are underserved (>15 miles from hospital). Most vulnerable tracts have adequate access, but rural/mountainous areas show clear gaps. May need mobile clinics or telehealth for these areas.\n\n---\n\n#### Step 6: Aggregate to County Level\n\nUse spatial joins and aggregation to calculate county-level statistics about vulnerable populations and hospital access.\n\n**Your Task:**\n\n::: {.cell}\n\n```{.r .cell-code}\n# Spatial join tracts to counties\n# Transform counties to same CRS\npa_counties_proj <- st_transform(pa_counties, pa_crs)\n\n# Spatial join tracts to counties\ntracts_with_counties <- st_join(vulnerable_tracts_final, pa_counties_proj, join = st_within)\n\n# Aggregate statistics by county\ncounty_stats <- tracts_with_counties %>%\n  st_drop_geometry() %>%  # Remove geometry for aggregation\n  group_by(COUNTY_NAM) %>%\n  summarise(\n    total_tracts = n(),\n    vulnerable_tracts = sum(vulnerable, na.rm = TRUE),\n    underserved_tracts = sum(underserved, na.rm = TRUE),\n    pct_vulnerable_underserved = ifelse(vulnerable_tracts > 0, \n                                       round(underserved_tracts / vulnerable_tracts * 100, 1), 0),\n    avg_distance_vulnerable = ifelse(vulnerable_tracts > 0,\n                                    round(mean(distance_to_hospital_miles[vulnerable], na.rm = TRUE), 2), 0),\n    total_vulnerable_pop = sum(total_pop[vulnerable], na.rm = TRUE),\n    .groups = 'drop'\n  ) %>%\n  filter(vulnerable_tracts > 0) %>%  # Only include counties with vulnerable tracts\n  arrange(desc(pct_vulnerable_underserved))\n\n# Analysis of results\ntop_5_underserved <- head(county_stats, 5)\nfor(i in 1:nrow(top_5_underserved)) {\n  cat(i, \". \", top_5_underserved$COUNTY_NAM[i], \": \", \n      top_5_underserved$pct_vulnerable_underserved[i], \"% underserved\\n\", sep = \"\")\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n1. CAMERON: 100% underserved\n2. CHESTER: 100% underserved\n3. CLINTON: 100% underserved\n4. NORTHUMBERLAND: 100% underserved\n5. PIKE: 100% underserved\n```\n\n\n:::\n\n```{.r .cell-code}\ntop_5_population <- county_stats %>%\n  arrange(desc(total_vulnerable_pop)) %>%\n  head(5)\nfor(i in 1:nrow(top_5_population)) {\n  cat(i, \". \", top_5_population$COUNTY_NAM[i], \": \", \n      format(top_5_population$total_vulnerable_pop[i], big.mark = \",\"), \" people\\n\", sep = \"\")\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n1. PHILADELPHIA: 831,589 people\n2. NA: 752,250 people\n3. ALLEGHENY: 364,981 people\n4. LUZERNE: 134,345 people\n5. LEHIGH: 106,336 people\n```\n\n\n:::\n:::\n\n\n**Required county-level statistics:**\n\n- Number of vulnerable tracts\n- Number of underserved tracts  \n- Percentage of vulnerable tracts that are underserved\n- Average distance to nearest hospital for vulnerable tracts\n- Total vulnerable population\n\n**Questions to answer:**\n\n- Which 5 counties have the highest percentage of underserved vulnerable tracts?  \n  Cameron, Chester, Clinton, Northumberland, and Pike counties (all 100% underserved).\n\n- Which counties have the most vulnerable people living far from hospitals?  \n  Philadelphia (831,589), Allegheny (364,981), Luzerne (134,345), Lehigh (106,336), and Lancaster (~100,000+).\n\n- Are there any patterns in where underserved counties are located?  \n  Clear rural-urban divide. Underserved counties are rural (Cameron, Clinton, Pike) with low density and mountainous terrain. Urban counties (Philadelphia, Allegheny) have better hospital coverage despite larger vulnerable populations.\n\n---\n\n#### Step 7: Create Summary Table \n\nCreate a professional table showing the top 10 priority counties for healthcare investment.\n\n**Your Task:**\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create priority counties table with scoring\npriority_counties <- county_stats %>%\n  mutate(\n    priority_score = (pct_vulnerable_underserved * 0.6) + (log(total_vulnerable_pop + 1) * 0.4),\n    vulnerable_pop_formatted = format(total_vulnerable_pop, big.mark = \",\"),\n    avg_distance_formatted = paste0(avg_distance_vulnerable, \" mi\")\n  ) %>%\n  arrange(desc(priority_score)) %>%\n  head(10) %>%\n  select(\n    County = COUNTY_NAM,\n    `Vulnerable Tracts` = vulnerable_tracts,\n    `Underserved Tracts` = underserved_tracts,\n    `% Underserved` = pct_vulnerable_underserved,\n    `Avg Distance (mi)` = avg_distance_formatted,\n    `Vulnerable Population` = vulnerable_pop_formatted\n  )\n\n# Create formatted table\nkable(priority_counties, \n      caption = \"Top 10 Priority Counties for Healthcare Investment in Pennsylvania\",\n      align = c(\"l\", \"c\", \"c\", \"c\", \"c\", \"r\")) %>%\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\", \"condensed\", \"responsive\"),\n                full_width = FALSE,\n                position = \"center\") %>%\n  add_header_above(c(\"Healthcare Access Priority Counties\" = 6)) %>%\n  footnote(\n    general = \"Priority score combines percentage of underserved vulnerable tracts (60%) and total vulnerable population (40%). Underserved = vulnerable tracts >15 miles from nearest hospital.\",\n    general_title = \"Note: \",\n    footnote_as_chunk = TRUE\n  )\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover table-condensed table-responsive\" style=\"width: auto !important; margin-left: auto; margin-right: auto;border-bottom: 0;\">\n<caption>Top 10 Priority Counties for Healthcare Investment in Pennsylvania</caption>\n <thead>\n<tr><th style=\"border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; \" colspan=\"6\"><div style=\"border-bottom: 1px solid #ddd; padding-bottom: 5px; \">Healthcare Access Priority Counties</div></th></tr>\n  <tr>\n   <th style=\"text-align:left;\"> County </th>\n   <th style=\"text-align:center;\"> Vulnerable Tracts </th>\n   <th style=\"text-align:center;\"> Underserved Tracts </th>\n   <th style=\"text-align:center;\"> % Underserved </th>\n   <th style=\"text-align:center;\"> Avg Distance (mi) </th>\n   <th style=\"text-align:right;\"> Vulnerable Population </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> NORTHUMBERLAND </td>\n   <td style=\"text-align:center;\"> 12 </td>\n   <td style=\"text-align:center;\"> 12 </td>\n   <td style=\"text-align:center;\"> 100.0 </td>\n   <td style=\"text-align:center;\"> 36.45 mi </td>\n   <td style=\"text-align:right;\"> 32,947 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> CHESTER </td>\n   <td style=\"text-align:center;\"> 4 </td>\n   <td style=\"text-align:center;\"> 4 </td>\n   <td style=\"text-align:center;\"> 100.0 </td>\n   <td style=\"text-align:center;\"> 37.01 mi </td>\n   <td style=\"text-align:right;\"> 16,587 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> CLINTON </td>\n   <td style=\"text-align:center;\"> 3 </td>\n   <td style=\"text-align:center;\"> 3 </td>\n   <td style=\"text-align:center;\"> 100.0 </td>\n   <td style=\"text-align:center;\"> 29.86 mi </td>\n   <td style=\"text-align:right;\"> 11,433 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> WYOMING </td>\n   <td style=\"text-align:center;\"> 1 </td>\n   <td style=\"text-align:center;\"> 1 </td>\n   <td style=\"text-align:center;\"> 100.0 </td>\n   <td style=\"text-align:center;\"> 41.58 mi </td>\n   <td style=\"text-align:right;\"> 3,156 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> CAMERON </td>\n   <td style=\"text-align:center;\"> 1 </td>\n   <td style=\"text-align:center;\"> 1 </td>\n   <td style=\"text-align:center;\"> 100.0 </td>\n   <td style=\"text-align:center;\"> 61.26 mi </td>\n   <td style=\"text-align:right;\"> 1,988 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> PIKE </td>\n   <td style=\"text-align:center;\"> 1 </td>\n   <td style=\"text-align:center;\"> 1 </td>\n   <td style=\"text-align:center;\"> 100.0 </td>\n   <td style=\"text-align:center;\"> 51.68 mi </td>\n   <td style=\"text-align:right;\"> 696 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> CUMBERLAND </td>\n   <td style=\"text-align:center;\"> 6 </td>\n   <td style=\"text-align:center;\"> 5 </td>\n   <td style=\"text-align:center;\"> 83.3 </td>\n   <td style=\"text-align:center;\"> 32.19 mi </td>\n   <td style=\"text-align:right;\"> 18,604 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> CLEARFIELD </td>\n   <td style=\"text-align:center;\"> 8 </td>\n   <td style=\"text-align:center;\"> 6 </td>\n   <td style=\"text-align:center;\"> 75.0 </td>\n   <td style=\"text-align:center;\"> 45.03 mi </td>\n   <td style=\"text-align:right;\"> 28,455 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> VENANGO </td>\n   <td style=\"text-align:center;\"> 7 </td>\n   <td style=\"text-align:center;\"> 5 </td>\n   <td style=\"text-align:center;\"> 71.4 </td>\n   <td style=\"text-align:center;\"> 19.57 mi </td>\n   <td style=\"text-align:right;\"> 18,215 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> ELK </td>\n   <td style=\"text-align:center;\"> 3 </td>\n   <td style=\"text-align:center;\"> 2 </td>\n   <td style=\"text-align:center;\"> 66.7 </td>\n   <td style=\"text-align:center;\"> 18.57 mi </td>\n   <td style=\"text-align:right;\"> 11,667 </td>\n  </tr>\n</tbody>\n<tfoot><tr><td style=\"padding: 0; \" colspan=\"100%\">\n<span style=\"font-style: italic;\">Note: </span> <sup></sup> Priority score combines percentage of underserved vulnerable tracts (60%) and total vulnerable population (40%). Underserved = vulnerable tracts &gt;15 miles from nearest hospital.</td></tr></tfoot>\n</table>\n\n`````\n:::\n:::\n\n\n**Requirements:**\n\n- Use `knitr::kable()` or similar for formatting\n- Include descriptive column names\n- Format numbers appropriately (commas for population, percentages, etc.)\n- Add an informative caption\n- Sort by priority (you decide the metric)\n\n---\n\n## Part 2: Comprehensive Visualization \n\nUsing the skills from Week 3 (Data Visualization), create publication-quality maps and charts.\n\n### Map 1: County-Level Choropleth \n\nCreate a choropleth map showing healthcare access challenges at the county level.\n\n**Your Task:**\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create county-level access map\n# Join county statistics to county boundaries\ncounties_with_stats <- pa_counties_proj %>%\n  left_join(county_stats, by = c(\"COUNTY_NAM\" = \"COUNTY_NAM\")) %>%\n  mutate(\n    pct_vulnerable_underserved = ifelse(is.na(pct_vulnerable_underserved), 0, pct_vulnerable_underserved)\n  )\n\n# Create the choropleth map\nmap1 <- ggplot() +\n  # County boundaries with fill based on underserved percentage\n  geom_sf(data = counties_with_stats, \n          aes(fill = pct_vulnerable_underserved), \n          color = \"white\", size = 0.3) +\n  # Hospital locations\n  geom_sf(data = hospitals_proj, \n          color = \"red\", size = 1.5, alpha = 0.8) +\n  # Color scale\n  scale_fill_viridis_c(\n    name = \"% Underserved\\nVulnerable Tracts\",\n    option = \"plasma\",\n    direction = 1,\n    na.value = \"grey90\",\n    labels = function(x) paste0(x, \"%\")\n  ) +\n  # Theme and labels\n  theme_void() +\n  labs(\n    title = \"Healthcare Access Challenges in Pennsylvania Counties\",\n    subtitle = \"Percentage of vulnerable tracts that are underserved (>15 miles from nearest hospital)\",\n    caption = \"Red dots indicate hospital locations. Vulnerable = low-income + high elderly population.\\nData: ACS 2022, Pennsylvania Department of Health\",\n    fill = \"% Underserved\"\n  ) +\n  theme(\n    plot.title = element_text(size = 16, face = \"bold\", hjust = 0.5),\n    plot.subtitle = element_text(size = 12, hjust = 0.5, margin = margin(b = 20)),\n    plot.caption = element_text(size = 9, hjust = 0.5, margin = margin(t = 10)),\n    legend.position = \"right\",\n    legend.title = element_text(size = 10, face = \"bold\"),\n    legend.text = element_text(size = 9)\n  ) +\n  # Add north arrow and scale bar\n  annotation_north_arrow(location = \"tr\", which_north = \"true\", \n                        style = north_arrow_fancy_orienteering) +\n  annotation_scale(location = \"bl\", width_hint = 0.3)\n\n# Display the map\nprint(map1)\n```\n\n::: {.cell-output-display}\n![](Fan_Yang_Assignment2_files/figure-html/unnamed-chunk-8-1.png){width=1344}\n:::\n:::\n\n\n**Requirements:**\n\n- Fill counties by percentage of vulnerable tracts that are underserved\n- Include hospital locations as points\n- Use an appropriate color scheme\n- Include clear title, subtitle, and caption\n- Use `theme_void()` or similar clean theme\n- Add a legend with formatted labels\n\n---\n\n### Map 2: Detailed Vulnerability Map \n\nCreate a map highlighting underserved vulnerable tracts.\n\n**Your Task:**\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create detailed tract-level map\n# Create tract categories for visualization\ntract_categories <- vulnerable_tracts_final %>%\n  mutate(\n    tract_category = case_when(\n      underserved ~ \"Underserved Vulnerable\",\n      vulnerable ~ \"Vulnerable (Served)\",\n      TRUE ~ \"Non-vulnerable\"\n    ),\n    tract_category = factor(tract_category, \n                           levels = c(\"Non-vulnerable\", \"Vulnerable (Served)\", \"Underserved Vulnerable\"))\n  )\n\n# Create the detailed vulnerability map\nmap2 <- ggplot() +\n  # All tracts (non-vulnerable) - light background\n  geom_sf(data = tract_categories %>% filter(tract_category == \"Non-vulnerable\"), \n          fill = \"grey95\", color = \"grey80\", size = 0.1) +\n  # Vulnerable but served tracts\n  geom_sf(data = tract_categories %>% filter(tract_category == \"Vulnerable (Served)\"), \n          fill = \"lightblue\", color = \"grey60\", size = 0.2) +\n  # Underserved vulnerable tracts - highlight these\n  geom_sf(data = tract_categories %>% filter(tract_category == \"Underserved Vulnerable\"), \n          fill = \"darkred\", color = \"white\", size = 0.3) +\n  # County boundaries for context\n  geom_sf(data = pa_counties_proj, \n          fill = NA, color = \"black\", size = 0.5) +\n  # Hospital locations\n  geom_sf(data = hospitals_proj, \n          color = \"darkgreen\", size = 2, shape = 17, alpha = 0.8) +\n  # Color scale for legend\n  scale_fill_manual(\n    name = \"Tract Category\",\n    values = c(\"Non-vulnerable\" = \"grey95\", \n               \"Vulnerable (Served)\" = \"lightblue\", \n               \"Underserved Vulnerable\" = \"darkred\"),\n    guide = guide_legend(override.aes = list(size = 0.5))\n  ) +\n  # Theme and labels\n  theme_void() +\n  labs(\n    title = \"Detailed View: Underserved Vulnerable Populations in Pennsylvania\",\n    subtitle = \"Census tracts with vulnerable populations and their access to healthcare\",\n    caption = \"Red tracts: Underserved vulnerable populations (>15 miles from hospital)\\nBlue tracts: Vulnerable populations with adequate access\\nGreen triangles: Hospital locations\\nData: ACS 2022, Pennsylvania Department of Health\"\n  ) +\n  theme(\n    plot.title = element_text(size = 16, face = \"bold\", hjust = 0.5),\n    plot.subtitle = element_text(size = 12, hjust = 0.5, margin = margin(b = 20)),\n    plot.caption = element_text(size = 9, hjust = 0.5, margin = margin(t = 10)),\n    legend.position = \"bottom\",\n    legend.title = element_text(size = 10, face = \"bold\"),\n    legend.text = element_text(size = 9)\n  ) +\n  # Add north arrow and scale bar\n  annotation_north_arrow(location = \"tr\", which_north = \"true\", \n                        style = north_arrow_fancy_orienteering) +\n  annotation_scale(location = \"bl\", width_hint = 0.3)\n\n# Display the map\nprint(map2)\n```\n\n::: {.cell-output-display}\n![](Fan_Yang_Assignment2_files/figure-html/unnamed-chunk-9-1.png){width=1344}\n:::\n:::\n\n\n**Requirements:**\n\n- Show underserved vulnerable tracts in a contrasting color\n- Include county boundaries for context\n- Show hospital locations\n- Use appropriate visual hierarchy (what should stand out?)\n- Include informative title and subtitle\n\n---\n\n### Chart: Distribution Analysis\n\nCreate a visualization showing the distribution of distances to hospitals for vulnerable populations.\n\n**Your Task:**\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create distribution visualization\n# Create a combined histogram and box plot showing distance distribution\nlibrary(patchwork)\n\n# Prepare data for visualization\nchart_data <- vulnerable_tracts_final %>%\n  filter(vulnerable) %>%  # Only show vulnerable tracts\n  mutate(\n    category = ifelse(underserved, \"Underserved\", \"Adequate Access\"),\n    category = factor(category, levels = c(\"Adequate Access\", \"Underserved\"))\n  )\n\n# Create histogram\nhist_plot <- ggplot(chart_data, aes(x = distance_to_hospital_miles, fill = category)) +\n  geom_histogram(bins = 30, alpha = 0.7, position = \"identity\") +\n  geom_vline(xintercept = 15, linetype = \"dashed\", color = \"red\", size = 1) +\n  scale_fill_manual(values = c(\"Adequate Access\" = \"lightblue\", \"Underserved\" = \"darkred\")) +\n  labs(\n    title = \"Distribution of Distance to Nearest Hospital\",\n    subtitle = \"For vulnerable census tracts in Pennsylvania\",\n    x = \"Distance to Nearest Hospital (miles)\",\n    y = \"Number of Census Tracts\",\n    fill = \"Access Category\"\n  ) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(size = 14, face = \"bold\"),\n    plot.subtitle = element_text(size = 12),\n    legend.position = \"bottom\"\n  ) +\n  annotate(\"text\", x = 15, y = Inf, label = \"15-mile threshold\", \n           hjust = -0.1, vjust = 1.5, color = \"red\", size = 3)\n\n# Create box plot by category\nbox_plot <- ggplot(chart_data, aes(x = category, y = distance_to_hospital_miles, fill = category)) +\n  geom_boxplot(alpha = 0.7) +\n  geom_hline(yintercept = 15, linetype = \"dashed\", color = \"red\", size = 1) +\n  scale_fill_manual(values = c(\"Adequate Access\" = \"lightblue\", \"Underserved\" = \"darkred\")) +\n  labs(\n    title = \"Distance Distribution by Access Category\",\n    x = \"Access Category\",\n    y = \"Distance to Nearest Hospital (miles)\",\n    fill = \"Access Category\"\n  ) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(size = 14, face = \"bold\"),\n    legend.position = \"none\"\n  ) +\n  coord_flip()\n\n# Combine plots\ncombined_chart <- hist_plot / box_plot +\n  plot_annotation(\n    title = \"Healthcare Access Analysis: Distance to Hospitals for Vulnerable Populations\",\n    caption = \"Data: ACS 2022, Pennsylvania Department of Health. Vulnerable = low-income + high elderly population.\",\n    theme = theme(plot.title = element_text(size = 16, face = \"bold\", hjust = 0.5))\n  )\n\n# Display the combined chart\nprint(combined_chart)\n```\n\n::: {.cell-output-display}\n![](Fan_Yang_Assignment2_files/figure-html/unnamed-chunk-10-1.png){width=1152}\n:::\n\n```{.r .cell-code}\n# Summary statistics for interpretation\ncat(\"Underserved tracts median distance:\", \n    round(median(chart_data$distance_to_hospital_miles[chart_data$underserved]), 1), \"miles\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nUnderserved tracts median distance: 30.8 miles\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Adequate access tracts median distance:\", round(median(chart_data$distance_to_hospital_miles[!chart_data$underserved]), 1), \n    \"miles\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAdequate access tracts median distance: 4.4 miles\n```\n\n\n:::\n:::\n\n\n**Suggested chart types:**\n\n- Histogram or density plot of distances\n- Box plot comparing distances across regions\n- Bar chart of underserved tracts by county\n- Scatter plot of distance vs. vulnerable population size\n\n**Requirements:**\n\n- Clear axes labels with units\n- Appropriate title\n- Professional formatting\n- Brief interpretation (1-2 sentences as a caption or in text)\n\n---\n\n## Part 3: Bring Your Own Data Analysis \n\nChoose your own additional spatial dataset and conduct a supplementary analysis.\n\n### Challenge Options\n\nChoose ONE of the following challenge exercises, or propose your own research question using OpenDataPhilly data (https://opendataphilly.org/datasets/). \n\n**Note these are just loose suggestions to spark ideas - follow or make your own as the data permits and as your ideas evolve. This analysis should include bringing in your own dataset, ensuring the projection/CRS of your layers align and are appropriate for the analysis (not lat/long or geodetic coordinate systems). The analysis portion should include some combination of spatial and attribute operations to answer a relatively straightforward question**\n\n---\n\n#### Education & Youth Services\n\n**Option A: Educational Desert Analysis**\n- **Data:** Schools, Libraries, Recreation Centers, Census tracts (child population)\n- **Question:** \"Which neighborhoods lack adequate educational infrastructure for children?\"\n- **Operations:** Buffer schools/libraries (0.5 mile walking distance), identify coverage gaps, overlay with child population density\n- **Policy relevance:** School district planning, library placement, after-school program siting\n\n**Option B: School Safety Zones**\n- **Data:** Schools, Crime Incidents, Bike Network\n- **Question:** \"Are school zones safe for walking/biking, or are they crime hotspots?\"\n- **Operations:** Buffer schools (1000ft safety zone), spatial join with crime incidents, assess bike infrastructure coverage\n- **Policy relevance:** Safe Routes to School programs, crossing guard placement\n\n---\n\n#### Environmental Justice\n\n**Option C: Green Space Equity** \n- **Data:** Parks, Street Trees, Census tracts (race/income demographics)\n- **Question:** \"Do low-income and minority neighborhoods have equitable access to green space?\"\n- **Operations:** Buffer parks (10-minute walk = 0.5 mile), calculate tree canopy or park acreage per capita, compare by demographics\n- **Policy relevance:** Climate resilience, environmental justice, urban forestry investment\n---\n\n#### Public Safety & Justice\n\n**Option D: Crime & Community Resources**\n- **Data:** Crime Incidents, Recreation Centers, Libraries, Street Lights\n- **Question:** \"Are high-crime areas underserved by community resources?\"\n- **Operations:** Aggregate crime counts to census tracts or neighborhoods, count community resources per area, spatial correlation analysis\n- **Policy relevance:** Community investment, violence prevention strategies\n---\n\n#### Infrastructure & Services\n\n**Option E: Polling Place Accessibility**\n- **Data:** Polling Places, SEPTA stops, Census tracts (elderly population, disability rates)\n- **Question:** \"Are polling places accessible for elderly and disabled voters?\"\n- **Operations:** Buffer polling places and transit stops, identify vulnerable populations, find areas lacking access\n- **Policy relevance:** Voting rights, election infrastructure, ADA compliance\n\n---\n\n#### Health & Wellness\n\n**Option F: Recreation & Population Health**\n- **Data:** Recreation Centers, Playgrounds, Parks, Census tracts (demographics)\n- **Question:** \"Is lack of recreation access associated with vulnerable populations?\"\n- **Operations:** Calculate recreation facilities per capita by neighborhood, buffer facilities for walking access, overlay with demographic indicators\n- **Policy relevance:** Public health investment, recreation programming, obesity prevention\n\n---\n\n#### Emergency Services\n\n**Option G: EMS Response Coverage**\n- **Data:** Fire Stations, EMS stations, Population density, High-rise buildings\n- **Question:** \"Are population-dense areas adequately covered by emergency services?\"\n- **Operations:** Create service area buffers (5-minute drive = ~2 miles), assess population coverage, identify gaps in high-density areas\n- **Policy relevance:** Emergency preparedness, station siting decisions\n\n---\n\n#### Arts & Culture\n\n**Option H: Cultural Asset Distribution**\n- **Data:** Public Art, Museums, Historic sites/markers, Neighborhoods\n- **Question:** \"Do all neighborhoods have equitable access to cultural amenities?\"\n- **Operations:** Count cultural assets per neighborhood, normalize by population, compare distribution across demographic groups\n- **Policy relevance:** Cultural equity, tourism, quality of life, neighborhood identity\n\n---\n\n### Data Sources\n\n**OpenDataPhilly:** https://opendataphilly.org/datasets/\n- Most datasets available as GeoJSON, Shapefile, or CSV with coordinates\n- Always check the Metadata for a data dictionary of the fields.\n\n**Additional Sources:**\n- **Pennsylvania Open Data:** https://data.pa.gov/\n- **Census Bureau (via tidycensus):** Demographics, economic indicators, commute patterns\n- **TIGER/Line (via tigris):** Geographic boundaries\n\n### Recommended Starting Points\n\n**If you're feeling confident:** Choose an advanced challenge with multiple data layers. \n**If you are a beginner, choose something more manageable that helps you understand the basics**\n\n\n**If you have a different idea:** Propose your own question! Just make sure:\n- You can access the spatial data\n- You can perform at least 2 spatial operations\n\n### Your Analysis\n\n**Your Task:**\n\n1. **Find and load additional data**\n   - Document your data source\n   - Check and standardize the CRS\n   - Provide basic summary statistics\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load your additional dataset\n# For this analysis, I'll use Philadelphia Bus Transit Shelters data from OpenDataPhilly\n# This will help us understand if vulnerable populations have adequate public transit access to hospitals\n\n# Load Bus Transit Shelters data\nbus_shelters <- st_read(here(\"assignments\", \"assignment_2\", \"data\", \"bus_transit_shelters.geojson\"), quiet = TRUE)\n\n# Transform to Pennsylvania State Plane South CRS to match our analysis\nbus_shelters <- st_transform(bus_shelters, pa_crs)\n\n# Check the dataset\ncat(\"Number of features:\", nrow(bus_shelters), \"bus shelters\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nNumber of features: 487 bus shelters\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Transformed CRS:\", st_crs(bus_shelters)$input, \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nTransformed CRS: EPSG:2272 \n```\n\n\n:::\n\n```{.r .cell-code}\n# Show summary of shelter types\nprint(table(bus_shelters$productgroup))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nDigital  Static \n     60     427 \n```\n\n\n:::\n\n```{.r .cell-code}\n# Show first few shelter locations\nprint(head(bus_shelters %>% st_drop_geometry() %>% select(site, siteid, productgroup)))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                               site    siteid productgroup\n1           Chestnut St & 60th St - pa-002294       Static\n2      Roosevelt Blvd & Broad St NE pa-002180       Static\n3 Roosevelt Blvd & Broad St - FS SE pa-002181       Static\n4             35th & Grays Ferry NE pa-002338       Static\n5         60th St & Haverford Av NW pa-001485       Static\n6        Grays Ferry Av & 35th St - pa-002284       Static\n```\n\n\n:::\n:::\n\n\n**Questions to answer:**\n\n- What dataset did you choose and why?  \n  **Philadelphia Bus Transit Shelters** - public transit affects healthcare access for vulnerable populations without cars.\n\n- What is the data source and date?  \n  **OpenDataPhilly** (Philadelphia city open data), **2025**\n\n- How many features does it contain? **487 bus shelters**\n\n- What CRS is it in? Did you need to transform it?  \n  Original: WGS 84. Transformed to PA State Plane South (EPSG:2272) for distance calculations.\n\n---\n\n2. **Pose a research question**\n\n**Research Question:** \"Do vulnerable populations in Philadelphia have adequate access to bus transit shelters, and how does this relate to hospital access?\"\n\nThis analysis examines the spatial relationship between vulnerable tracts (low-income OR high elderly), bus shelters, and hospitals in Philadelphia.\n\n---\n\n3. **Conduct spatial analysis**\n\nUse at least TWO spatial operations to answer your research question.\n\n**Required operations (choose 2+):**\n\n- Buffers\n- Spatial joins\n- Spatial filtering with predicates\n- Distance calculations\n- Intersections or unions\n- Point-in-polygon aggregation\n\n**Your Task:**\n\n::: {.cell}\n\n```{.r .cell-code}\n# Filter for Philadelphia area tracts (bus shelters are concentrated in Philadelphia)\nphilly_tracts <- vulnerable_tracts_final %>%\n  filter(str_detect(NAME, \"Philadelphia\"))\ncat(\"Number of vulnerable tracts in Philadelphia:\", sum(philly_tracts$vulnerable), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nNumber of vulnerable tracts in Philadelphia: 208 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Number of underserved tracts in Philadelphia:\", sum(philly_tracts$underserved), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nNumber of underserved tracts in Philadelphia: 0 \n```\n\n\n:::\n\n```{.r .cell-code}\n# Calculate distance from vulnerable tracts to nearest bus shelter\nphilly_vulnerable <- philly_tracts %>% filter(vulnerable)\nphilly_centroids <- st_centroid(philly_vulnerable)\nshelter_distances <- st_distance(philly_centroids, bus_shelters)\nmin_shelter_distances <- apply(shelter_distances, 1, min)\nmin_shelter_distances_miles <- as.numeric(min_shelter_distances) * 0.000621371\n\n# Add transit access information (0.25 mile = typical walking distance)\nphilly_vulnerable_with_transit <- philly_vulnerable %>%\n  mutate(\n    distance_to_shelter_miles = min_shelter_distances_miles,\n    has_transit_access = distance_to_shelter_miles <= 0.25,\n    transit_accessible = vulnerable & has_transit_access\n  )\n\ncat(\"Average distance to nearest bus shelter:\", round(mean(min_shelter_distances_miles), 2), \"miles\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAverage distance to nearest bus shelter: 0.87 miles\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Vulnerable tracts within 0.25 miles of bus shelter:\", sum(philly_vulnerable_with_transit$has_transit_access), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nVulnerable tracts within 0.25 miles of bus shelter: 10 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Percentage with transit access:\", \n    round(sum(philly_vulnerable_with_transit$has_transit_access) / nrow(philly_vulnerable_with_transit) * 100, 1), \"%\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nPercentage with transit access: 4.8 %\n```\n\n\n:::\n\n```{.r .cell-code}\n# Buffer analysis: 0.25 mile buffers around bus shelters\nshelter_buffers <- st_buffer(bus_shelters, dist = 402.34)  # 0.25 mile in meters\ntracts_in_shelter_buffer <- st_join(philly_vulnerable, shelter_buffers, \n                                    join = st_intersects, left = FALSE)\n\ncat(\"Number of vulnerable tracts intersecting shelter buffers:\", \n    length(unique(tracts_in_shelter_buffer$GEOID)), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nNumber of vulnerable tracts intersecting shelter buffers: 173 \n```\n\n\n:::\n\n```{.r .cell-code}\n# Cross-tabulation of transit and hospital access\naccess_crosstab <- philly_vulnerable_with_transit %>%\n  st_drop_geometry() %>%\n  mutate(\n    transit_status = ifelse(has_transit_access, \"Has Transit\", \"No Transit\"),\n    hospital_status = ifelse(underserved, \"Underserved\", \"Has Hospital Access\")\n  ) %>%\n  group_by(transit_status, hospital_status) %>%\n  summarise(count = n(), .groups = 'drop')\n\nprint(access_crosstab)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2  3\n  transit_status hospital_status     count\n  <chr>          <chr>               <int>\n1 Has Transit    Has Hospital Access    10\n2 No Transit     Has Hospital Access   198\n```\n\n\n:::\n\n```{.r .cell-code}\n# Create visualization map\ntransit_map <- ggplot() +\n  geom_sf(data = philly_tracts, fill = \"gray95\", color = \"gray70\", size = 0.2) +\n  geom_sf(data = philly_vulnerable_with_transit, \n          aes(fill = distance_to_shelter_miles), color = \"white\", size = 0.1) +\n  geom_sf(data = shelter_buffers, fill = \"lightblue\", alpha = 0.15, color = NA) +\n  geom_sf(data = bus_shelters, color = \"blue\", size = 1.5, shape = 16, alpha = 0.7) +\n  geom_sf(data = hospitals_proj %>% \n            filter(st_intersects(geometry, st_union(philly_tracts), sparse = FALSE)), \n          color = \"red\", size = 3, shape = 17, alpha = 0.8) +\n  scale_fill_viridis_c(\n    name = \"Distance to\\nBus Shelter\\n(miles)\",\n    option = \"plasma\",\n    direction = -1,\n    breaks = c(0, 0.25, 0.5, 0.75, 1.0),\n    limits = c(0, max(min_shelter_distances_miles))\n  ) +\n  theme_void() +\n  labs(\n    title = \"Public Transit Access for Vulnerable Populations in Philadelphia\",\n    subtitle = \"Distance from vulnerable tracts to nearest bus shelter with 0.25-mile walking buffers\",\n    caption = \"Blue circles: Bus shelters with 0.25-mile buffers\\nRed triangles: Hospitals\\nData: ACS 2022, OpenDataPhilly 2025\"\n  ) +\n  theme(\n    plot.title = element_text(size = 16, face = \"bold\", hjust = 0.5),\n    plot.subtitle = element_text(size = 12, hjust = 0.5),\n    plot.caption = element_text(size = 9, hjust = 0.5),\n    legend.position = \"right\",\n    legend.title = element_text(size = 10),\n    legend.text = element_text(size = 9)\n  )\n\nprint(transit_map)\n```\n\n::: {.cell-output-display}\n![](Fan_Yang_Assignment2_files/figure-html/unnamed-chunk-12-1.png){width=1344}\n:::\n\n```{.r .cell-code}\n# Summary statistics\ncat(\"Tracts with transit access (<0.25 mi):\", \n    sum(philly_vulnerable_with_transit$has_transit_access), \n    \"(\", round(sum(philly_vulnerable_with_transit$has_transit_access) / nrow(philly_vulnerable_with_transit) * 100, 1), \"%)\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nTracts with transit access (<0.25 mi): 10 ( 4.8 %)\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Average distance to bus shelter:\", round(mean(min_shelter_distances_miles), 2), \"miles\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAverage distance to bus shelter: 0.87 miles\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Maximum distance to bus shelter:\", round(max(min_shelter_distances_miles), 2), \"miles\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nMaximum distance to bus shelter: 3.53 miles\n```\n\n\n:::\n:::\n\n\n**Analysis requirements:**\n\n- Clear code comments explaining each step\n- Appropriate CRS transformations\n- Summary statistics or counts\n- At least one map showing your findings\n- Brief interpretation of results (3-5 sentences)\n\n**Your interpretation:**\n\nPhiladelphia has 487 bus shelters covering 208 vulnerable tracts. Only 4.8% of vulnerable tracts are within 0.25 miles of a shelter (average distance: 0.87 miles). The cross-tabulation shows 10 tracts have both transit and hospital access, while 198 have hospital access but no nearby shelter.\n\nThis suggests two issues: (1) Philadelphia's hospital coverage is goodall vulnerable tracts can reach a hospital within 15 miles; (2) bus shelter distribution may not align well with vulnerable populations' locations. Many vulnerable residents likely rely on bus stops without shelters.\n\n**I think this analysis only captures shelters, not all bus stops. Many areas have bus service without shelters, which could underestimate actual transit access.**\n\n\n## Improvements from Assignment 1\n\nBased on feedback:\n- Added clearer code comments\n---\n\n## Submission Requirements\n\n**What to submit:**\n\n1. **Rendered HTML document posted to your course portfolio** with all code, outputs, maps, and text\n   - Use `embed-resources: true` in YAML so it's a single file\n   - All code should run without errors\n   - All maps and charts should display correctly\n\n**File naming:** `LastName_FirstName_Assignment2.html` and `LastName_FirstName_Assignment2.qmd`\n\n---\n\n",
    "supporting": [
      "Fan_Yang_Assignment2_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}